/**
 * AreaEditor 2.0
 * @github.com/kohunglee/areaEditor
 * @license MIT
 */
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.AreaEditor=e()}(this,function(){"use strict";function n(t,e={indentType:{type:"space",count:4}}){if(!(this instanceof n))return new n(t,e);this.element="string"==typeof t?document.querySelectorAll(t):t,this.indentType=e.indentType,this.init()}return n.prototype.init=function(){for(var t=0;t<this.element.length;t++){if(!this.element[t])return void console.error("AreaEditor: Missing element");if("TEXTAREA"!==this.element[t].tagName)return void console.error("AreaEditor: The element must be a textarea");this.setupEvents(this.element[t])}},n.prototype.setupEvents=function(t){t.addEventListener("keydown",this.onKeyDown.bind(this)),t.addEventListener("input",this.onInput.bind(this)),t.addEventListener("paste",this.onPaste.bind(this)),t.addEventListener("keyup",this.onKeyUp.bind(this))},n.prototype.isPreventAuto=!1,n.prototype.isPreventKEY=["Backspace","Delete","Meta","Control","Ctrl"],n.prototype.beforeEnterScrollTop=0,n.prototype.onKeyUp=function(t){this.isPreventKEY.includes(t.key)&&(this.isPreventAuto=!1)},n.prototype.onPaste=function(t){this.isPreventAuto=!0},n.prototype.onInput=function(t){if(this.isPreventAuto)this.isPreventAuto=!1;else{var e,n,r,i=t.target.selectionStart,s=t.target.selectionEnd,o=t.target.value,a=o[i],l=o[i-1],h=o[i-2],u={"{":"}","[":"]","(":")",'"':'"',"'":"'","`":"`"};if(["{","(","[",'"',"'","`","]","}",")"].includes(l)&&i===s){if(this.isPreventAuto)return void(this.isPreventAuto=!1);var g,c=u[l]||"";for(g in u)if(g===h&&u[g]===l&&a===l)return t.target.value=o.substring(0,i)+o.substring(i+1),void(t.target.selectionStart=t.target.selectionEnd=i);t.target.value=o.substring(0,i)+c+o.substring(i),t.target.selectionStart=t.target.selectionEnd=i}"\n"===l&&(c=o.lastIndexOf("\n",i-2)+1,e=(c=o.substring(c,i-1)).match(/^\s*/)[0],(r={"{":"}","[":"]","(":")","<":">",">":"<"})[l=c.trim().slice(-1)]?(n=a===r[l]?"\n"+e+this.tabChar+"\n"+e:"\n"+e+(">"!==l?this.tabChar:""),t.target.value=o.substring(0,i-1)+n+o.substring(s-1).replace(/\n/,""),t.target.selectionStart=t.target.selectionEnd=i-1+e.length+(">"!==l||a===r[l]?1+this.tabLength:1)):(n="\n"+e,t.target.value=o.substring(0,i-1)+n+o.substring(s-1).replace(/\n/,""),t.target.selectionStart=t.target.selectionEnd=i-1+n.length),this.beforeEnterScrollTop)&&(t.target.scrollTop=this.beforeEnterScrollTop,this.beforeEnterScrollTop=0)}},n.prototype.onKeyDown=function(t){var e=t.target.selectionStart,n=t.target.selectionEnd,r=t.target.value;if(this.tabChar="tab"===this.indentType.type?"\t":Array(this.indentType.count+1).join(" "),this.tabLength=this.indentType.count,this.isPreventKEY.includes(t.key)&&(this.isPreventAuto=!0),"Tab"===t.key){if(t.preventDefault(),e===n)return t.target.value=r.substring(0,e)+this.tabChar+r.substring(n),void(t.target.selectionStart=t.target.selectionEnd=e+this.tabLength);var i=r.split("\n"),s=r.split("\n"),o=(r.substring(0,e).match(/\n/g)||[]).length,a=(r.substring(0,n).match(/\n/g)||[]).length;if(t.shiftKey){for(var l=o;l<=a;l++)i[l]=this._removeLeadingSpaces(i[l],this.tabLength);t.target.value=i.join("\n");var h=s[o].length-s[o].trimStart().length,u=Math.min(this.tabLength,h),g=this._arrSum(i,o);t.target.selectionStart=0<h?e-u-o<g?g+o:e-u:e,t.target.selectionEnd=n-(s.join("\n").length-t.target.value.length)}else{for(l=o;l<=a;l++)i[l]=this.tabChar+i[l];t.target.value=i.join("\n"),t.target.selectionStart=e+this.tabLength,t.target.selectionEnd=n+this.tabLength*(o===a?1:a-o+1)}}"Backspace"===t.key&&(i=r.split("\n"),o=(r.substring(0,e).match(/\n/g)||[]).length,e===n)&&/^[\s\t]*$/.test(i[o])&&""!==i[o]&&(t.target.selectionStart=this._arrSum(i,o)+o,t.target.selectionEnd=e),"Enter"===t.key&&(this.beforeEnterScrollTop=t.target.scrollTop)},n.prototype._removeLeadingSpaces=function(t,e){e=new RegExp("^([ \\t]{0,".concat(e,"})"));return t.replace(e,"")},n.prototype._arrSum=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return t.slice(0,e).map(function(t){return n+=t.length}),n},n});
